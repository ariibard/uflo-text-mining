---
format:
  revealjs:
    echo: true
    theme: custom.scss
embed-resources: true
---

# Expresiones regulares (`regex`)


## Qu茅 es una expresi贸n regular?

::: r-stack
Son patrones utilizados para encontrar coincidencias dentro de 
:::



## 驴Para qu茅 se utilizan?

::: incremental
-   B煤squeda avanzada en texto libre

-   Validaci贸n de formularios

-   Extracci贸n de datos de grandes vol煤menes de texto.

-   Sustituci贸n de patrones en textos masivos.
:::

## 驴Qu茅 es una expresi贸n regular?

```r
Ejemplo  <- "((?<=(\\bh?t[-/\\.\\\\ ]?a|\\bp[-/\\.\\\\ ]?a|presi.n|
arterial|tensi.n|tens.|\\bb\\.?d|\\bb\\.?i)
?[\\.:\\,=]? ?)((2[0-5][0-9]|1[0-9][0-9]|0[5-9][0-9]|
[5-9][0-9])(( ?)[/\\-\\\\ ]
( ?))(0[3-9][0-9]|1[0-3][0-9]|[3-9][0-9])))|((?<=\\D|\\b)
((2[0-5][0-9]|1[0-9][0-9]|0[5-9][0-9]
|[5-9][0-9])(( ?)[/\\-\\\\ ]( ?))(0[3-9][0-9]|1[0-2][0-9]|
[3-9][0-9]))(?= ? ?(mm|b\\.?d\\.?\\b|b\\.?i\\.?\\b)))"

```
## Caracter铆sticas

::: incremental
- Son trasversales a todos los lenguajes de programaci贸n 

- Asustan y parecen inentendibles
:::

## regex en R

Para que `r` entienda que es una expresi贸n regular usamos la funci贸n `regex()`

```{r echo = TRUE}
#| code-line-numbers: "5"
library(stringr)
library(tidyverse)
#style_mono_quarto(path_scss = "custom.scss")
texto <- "Hola mundo, hola universo"
patron <- regex("mundo",T)

# Detecta si el patr贸n est谩 presente en el texto
str_detect(texto, patron)
```


## Librer铆a a utilizar

::::: columns
::: {.column width="30%"}
![](imagenes/1_string.png){fig-align="center"}
:::

::: {.column width="70%"}
<br> El paquete `stringr` proporciona un conjunto de funciones dise帽adas para que trabajar con cadenas de texto
:::
:::::

## Funciones `stringr` : coincidencia

::: incremental
-   `str_detect(texto, patron)`: Detecta si un patr贸n est谩 presente en una cadena (devuelve `TRUE/FALSE`).

-   `str_which(texto, patron)`: Devuelve los 铆ndices de las cadenas que coinciden con un patr贸n.

-   `str_count(texto, patron)`: Cuenta cu谩ntas veces aparece un patr贸n en cada cadena.
:::

## Funciones `stringr` : coincidencia

::: incremental
-   `str_subset(texto, patron)`: Filtra las cadenas que contienen un patr贸n.

-   `str_match(texto, patron)`: Extrae las coincidencias del patr贸n con grupos de captura.

-   `str_extract(texto, patronn)`: Extrae la primera coincidencia del patr贸n.

-   `str_extract_all(texto, patron)`: Extrae **todas** las coincidencias del patr贸n
:::

## Funciones `stringr` : reemplazo y divisi贸n

::: incremental
-   `str_replace(texto, patron, reemplazo)`: Reemplaza la primera coincidencia del patr贸n por otro texto.

-   `tr_replace_all(texto, patron, reemplazo)`: Reemplaza todas las coincidencias del patr贸n.

-   `str_split(string, pattern):` Divide la cadena en partes basadas en un patr贸n.
:::

# 驴C贸mo armar expresiones regulares?

## Mi primera `regex`

Vamos a imaginar que tenemos un excel con las **anotaciones de las sesiones de terapia de un m茅dico**, y en base a ese campo de "notas" tenemos que traernos aquellos **registros** que tienen determinadas caracter铆sticas

## Armando expresiones regulares

La columna `id` tiene el identificador de historia clinica del paciente y `notas` las anotaciones del profesional

```{r}
notas_sesiones <- tibble::tibble(id = 1:13,
                        nota = c("ausente", "ausente al turno", "tuvo un papa ausente", "no concurri贸 al turno", "su mam谩 estaba ausente", "no vino al turno su mama", "no vino turno", "mi hermana estaba ausente een casa","La ausencia de luz fue larga.", "se hizo un pap", "hermano concurre al turno", "DNI: 12345678", "ultima consulta en 2005"))

head(notas_sesiones)
```

## Observamos la base

```{r}
DT::datatable(notas_sesiones)
```

## Expresi贸n regular: `ausentes`

Me gustar铆a traerme todos los id de los pacientes que estuvieron ausentes a su sesi贸n

★ *con poner solo **ausente** no alcanza*

```{r}

patron <- regex("ausente",T)

notas_sesiones |>
  filter(str_detect(nota, patron))

```

## Inicio de la expresi贸n

`^` indica que la expresi贸n a buscar debe estar al **inicio** del vector o fila `|` es un "o"

```{r}

patron <- regex("^ausente",T)

notas_sesiones |>
  filter(str_detect(nota, patron))

```

## Caracteres l贸gicos

`|` es un "o" l贸gico en regex\
`()` **Agrupa expresiones** para combinarlas con `|` u otros operadores

```{r}

patron <- regex("^ausente|no (concurre|asiste|vino) al turno",T)

notas_sesiones |>
  filter(str_detect(nota, patron))

```

## ????

`?` hace que lo que le siga sea opcional

```{r}

patron <- regex("^ausente|no (concurre|asiste|vino) ?al turno",T)

notas_sesiones |>
  filter(str_detect(nota, patron))

```

## Borde de palabra

`\\b` limite de palabra *boundary*

```{r}

patron <- regex("^ausente|\\bno (concurre|asiste|vino) ?al turno",T)

notas_sesiones |>
  filter(str_detect(nota, patron))

```

## el punto

`.` indica que podria ser cualquier caracter

**Ejemplo**: Si quiero traerme todas las notas que digan `mam谩`

```{r}

patron <- regex("mam谩|pap谩",T)

notas_sesiones |>
  filter(str_detect(nota, patron))

```

## el punto

`.` indica que podria ser cualquier caracter

**Ejemplo**: Si quiero traerme todas las notas que digan `mam谩`

```{r}

patron <- regex("\\bmam.\\b|\\bpap.\\b",T)

notas_sesiones |>
  filter(str_detect(nota, patron))

```

## Cantidad de repeticiones o catacteres

`{n}` exactamente n repeticiones.

`{n,}` al menos n repeticiones.

`{n,m}` entre n y m repeticiones.

```{r}
patron <- regex("e{2,3}", TRUE) 
notas_sesiones |>
  filter(str_detect(nota, patron))
```

## Cantidad de repeticiones o catacteres

Si se le pone un . antes, busca cercan铆a entre tantos caracteres

**Ejemplo**: Busco mam谩 o pap谩 que se encuentren cerca de "ausente"

```{r}
patron <- regex("(\\bmam.\\b|\\bpap.\\b).{0,15}ausent", TRUE) 
notas_sesiones |>
  filter(str_detect(nota, patron))
```

## Clases de caracteres

`[aeiou]` busca cualquier vocal.

`[0-9]` busca cualquier n煤mero.

`[^aeiou]` busca cualquier letra que no sea vocal.

```{r}
patron <- regex("[0-9]", TRUE) 
notas_sesiones |>
  filter(str_detect(nota, patron))
```

## Clases de caracteres

`\\d` busca n煤meros.

`\\D` busca letras o s铆mbolos.

```{r}
patron <- regex("\\d{8}", TRUE) #busco solo 8 digitos
notas_sesiones |>
  filter(str_detect(nota, patron))

```

## Espacios

`\\s+` encuentra uno o m谩s espacios.

`\\S+` encuentra palabras sin espacios.

```{r}
patron <- regex("\\s", TRUE)  # Encuentra espacios

frases <- tibble(nota = c("sinespacio", "con  espacios"))

frases |>
  filter(str_detect(nota, patron))
```

## Recursos

-   [cheatsheet](https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_strings.pdf) con las funciones de stringr

-   m谩s [caracteres](https://cheatography.com/davechild/cheat-sheets/regular-expressions/) para armado de expresiones regulares

# Recreo

> Volvemos en 10 minutos para comenzar con el taller

![](https://i.pinimg.com/originals/10/d2/05/10d205b912352788a8b7116a43c00230.gif){fig-align="center" style="border-radius: 100%;"}
